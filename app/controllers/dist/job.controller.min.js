"use strict";var jwtEncode=require("jwt-encode"),db=require("../models"),_require=require("../utils/verifyToken"),setToken=_require.setToken,_require2=require("mongoose"),set=_require2.set,Job=db.jobs,moment=require("moment"),limitAccNum=100,expirationTime=1800;exports.postJob=function(t,r){var s,o,n,a,i,u,l,c,d,b;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("register"),s=t.user,t.jobId)return e.next=6,regeneratorRuntime.awrap(Job.find().sort({jobId:-1}).limit(1));e.next=25;break;case 6:return o=e.sent,n=0<o.length?o[0].jobId:0,a=n+1,e.next=11,regeneratorRuntime.awrap(Job.findOne({jobId:a}));case 11:return e.sent,i=t.body,console.log("new Id-------------\x3e",a),i.entryDate=new Date,i.jobId=a,u=new Job(i),e.next=19,regeneratorRuntime.awrap(u.save());case 19:l={email:s.email,userRole:s.userRole,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+expirationTime},c=setToken(l),console.log(c),r.status(201).json({message:"Successfully Registered",token:c}),e.next=29;break;case 25:console.log("content",t.body.content),d={jobId:t.body.jobId},b={bid:t.body.content},Job.findOneAndUpdate({id:d},{$set:{updateData:b}},{new:!1},function(e,t){if(e)r.status(500).json({error:e}),console.log(e);else{console.log("updated",t);var o={email:s.email,userRole:s.userRole,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+expirationTime},n=setToken(o);console.log(n),r.status(200).json({message:"Trading Signals saved Successfully",token:n,user:t})}});case 29:e.next=35;break;case 31:return e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",r.status(500).json({message:"An Error Occured!"}));case 35:case"end":return e.stop()}},null,null,[[0,31]])},exports.shifts=function(t,o){var n,r,s,a,i,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.user,r=t.headers.role,console.log("role------",t.headers.role),e.next=6,regeneratorRuntime.awrap(Job.find({}));case 6:s=e.sent,console.log("data---++++++++++++++++++++++++>",s),a=[],"Facilities"===r?s.map(function(e,t){a.push([e.degree,e.entryDate,e.jobId,e.jobNum,e.location,e.unit,e.shiftDate,e.shift,e.bid_offer,e.bid,e.jobStatus,e.Hired,e.timeSheetVerified,e.jobRating,"delete"])}):"Clinicians"===r&&s.map(function(e,t){a.push({jobId:e.jobId,unit:e.unit,jobNum:e.jobNum,degree:e.degree,location:e.location,shiftDate:e.shiftDate,jobStatus:e.jobStatus,payRate:e.payRate,shiftDates:"",bonus:e.bonus})}),i={email:n.email,userRole:n.userRole,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+expirationTime},(u=setToken(i))?o.status(200).json({message:"Successfully Get!",jobData:a,token:u}):o.status(400).json({message:"Cannot logined User!"}),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",o.status(500).json({message:"An Error Occured!"}));case 19:case"end":return e.stop()}},null,null,[[0,15]])};
//# sourceMappingURL=job.controller.min.js.map
