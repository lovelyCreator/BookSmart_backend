"use strict";var jwtEncode=require("jwt-encode"),db=require("../models"),ChatUser=db.chatusers,Chat=db.chats,secret="secret";exports.wallet=function(r,t){var n,s,a,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body.walletAddress,e.prev=1,e.next=4,regeneratorRuntime.awrap(ChatUser.findOne({walletAddress:n}));case 4:if(s=e.sent)return a={username:s.username},u={logined:!0},e.next=10,regeneratorRuntime.awrap(ChatUser.updateOne(a,u));e.next=14;break;case 10:return e.sent,e.abrupt("return",t.status(200).json({isWalletLogin:"true",username:s.username}));case 14:return e.abrupt("return",t.status(200).json({isWalletLogin:!1}));case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),t.status(500).json({message:"An error occurred"});case 20:case"end":return e.stop()}},null,null,[[1,17]])},exports.create=function(r,t){var n,s,a,u,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,s=n.username,a=n.walletAddress,console.log(s,a),e.prev=2,e.next=5,regeneratorRuntime.awrap(ChatUser.findOne({username:s}));case 5:if(u=e.sent,console.log(u),u)return o=ChatUser.updateOne({username:s,logined:!0}),console.log("log",o.logined),e.abrupt("return",t.status(400).json({message:"Username is already taken"}));e.next=11;break;case 11:return c=new ChatUser({username:s,walletAddress:a,logined:!0,unread:unread}),console.log(c),e.next=15,regeneratorRuntime.awrap(c.save());case 15:t.status(201).json(c),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(2),t.status(500).json({message:"An error occurred"});case 21:case"end":return e.stop()}},null,null,[[2,18]])},exports.getMessage=function(e,r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Chat.find({}));case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).json({message:"No messages"}));case 6:return e.abrupt("return",r.status(200).json({message:t}));case 9:e.prev=9,e.t0=e.catch(0),r.status(500).json({message:"An error occurred"});case 12:case"end":return e.stop()}},null,null,[[0,9]])};
//# sourceMappingURL=chat.controller.min.js.map
