"use strict";var jwt=require("jsonwebtoken"),db=require("../models"),Auth=db.authentications,Clinical=db.clinical,Facility=db.facilities,expirationTime=2592e3,verifyToken=function(r,n,i){var e=r.headers.authorization;if(e){console.log("hhhhhh");var s=e.split(" ")[1];if(console.log("token=-================>","----",s),!s)return n.status(401).json({success:!1,message:"You are not authorized!"});jwt.verify(s,process.env.JWT_SECRET_KEY,function(e,s){if(e)return console.log("err",e),n.status(401).json({success:!1,message:"Token is invalid"});r.user=s,i()})}},setToken=function(e){return jwt.sign(e,process.env.JWT_SECRET_KEY)},verifyUser=function(r,n,i){verifyToken(r,n,function(){var s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},"Facilities"===r.user.userRole)return e.next=4,regeneratorRuntime.awrap(Facility.findOne({email:r.user.email,userRole:r.user.userRole}));e.next=7;break;case 4:s=e.sent,e.next=11;break;case 7:if("Clinicians"===r.user.userRole)return e.next=10,regeneratorRuntime.awrap(Clinical.findOne({email:r.user.email,userRole:r.user.userRole}));e.next=11;break;case 10:s=e.sent;case 11:s?Math.floor(Date.now()/1e3)<r.user.exp?(r.user=s,i()):n.status(401).json({success:!1,message:"Token is expired"}):n.status(401).json({success:!1,message:"You are not authenticated!"});case 12:case"end":return e.stop()}})})},verifyAdmin=function(e,s,r){verifyToken(e,s,function(){if("admin"!==e.user.role)return s.status(401).json({success:!1,message:"You are not authorized"});r()})};module.exports={verifyToken:verifyToken,verifyUser:verifyUser,verifyAdmin:verifyAdmin,setToken:setToken};
//# sourceMappingURL=verifyToken.min.js.map
